<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏Å‡∏°‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Sarabun', sans-serif;
        }

        .modal-overlay {
            transition: opacity 0.3s ease;
        }

        .modal-content {
            transition: transform 0.3s ease;
        }

        .shake {
            animation: shake 0.5s cubic-bezier(.36, .07, .19, .97) both;
            transform: translate3d(0, 0, 0);
        }

        @keyframes shake {

            10%,
            90% {
                transform: translate3d(-1px, 0, 0);
            }

            20%,
            80% {
                transform: translate3d(2px, 0, 0);
            }

            30%,
            50%,
            70% {
                transform: translate3d(-4px, 0, 0);
            }

            40%,
            60% {
                transform: translate3d(4px, 0, 0);
            }
        }

        /* Drag and Drop Styles */
        .draggable-item {
            cursor: grab;
            user-select: none;
        }

        .dragging {
            opacity: 0.5;
            cursor: grabbing;
            background-color: #f1f5f9;
            /* slate-100 */
        }

        .drop-target.drag-over {
            border-color: #34d399;
            /* emerald-400 */
            background-color: rgba(16, 185, 129, 0.1);
        }

        .fade-out {
            animation: fadeOut 0.5s ease-out forwards;
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
                transform: scale(1);
            }

            to {
                opacity: 0;
                transform: scale(0.9);
            }
        }

        .matched {
            visibility: hidden;
            /* Hide after animation */
        }
    </style>
</head>

<body class="bg-gray-100">
    <div class="min-h-screen w-full text-slate-800 selection:bg-cyan-400/30">
        <div class="mx-auto max-w-4xl px-4 py-8">
            <!-- Header -->
            <header class="mb-6 flex items-center justify-between">
                <div>
                    <h1
                        class="text-2xl sm:text-3xl font-extrabold bg-gradient-to-r from-cyan-500 to-emerald-500 bg-clip-text text-transparent">
                        ‡πÄ‡∏Å‡∏°‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ
                    </h1>
                    <p class="text-slate-500 text-sm">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ ‡∏£‡∏∞‡∏î‡∏±‡∏ö ‡∏õ‡∏ß‡∏™ | ‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤ 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</p>
                </div>
                <div class="hidden sm:flex items-center gap-2">
                    <div
                        class="flex items-center gap-2 rounded-full border border-gray-200/80 bg-white/60 backdrop-blur-sm px-3 py-1 text-sm">
                        <span>üèÜ</span>
                        <span id="score-display" class="text-slate-700">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: 0</span>
                    </div>
                </div>
            </header>

            <!-- Scenes Container -->
            <main>
                <!-- Intro Scene -->
                <div id="intro-scene">
                    <div
                        class="rounded-2xl border border-gray-200 bg-white/70 backdrop-blur p-6 shadow-lg shadow-gray-200/60 text-center py-12">
                        <h2 class="text-xl sm:text-2xl font-bold mb-2 text-slate-900">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏Å‡∏°</h2>
                        <p class="text-slate-600 mb-6">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏Å‡∏°‡∏ó‡∏µ‡πà‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô</p>
                        <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6 max-w-2xl mx-auto">
                            <!-- Quiz Card -->
                            <div id="start-quiz-btn"
                                class="group rounded-2xl border border-gray-200 bg-white/50 p-6 text-center hover:border-cyan-400/80 hover:bg-white transition-all cursor-pointer shadow-md hover:shadow-xl">
                                <div class="text-5xl mb-3">üöÄ</div>
                                <h3 class="text-xl font-bold text-slate-800 mb-1">‡πÄ‡∏Å‡∏°‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°</h3>
                                <p class="text-slate-500 text-sm">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏à‡∏≤‡∏Å 4 ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</p>
                            </div>
                            <!-- Match Card -->
                            <div id="start-match-btn"
                                class="group rounded-2xl border border-gray-200 bg-white/50 p-6 text-center hover:border-fuchsia-400/80 hover:bg-white transition-all cursor-pointer shadow-md hover:shadow-xl">
                                <div class="text-5xl mb-3">üß©</div>
                                <h3 class="text-xl font-bold text-slate-800 mb-1">‡πÄ‡∏Å‡∏°‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà</h3>
                                <p class="text-slate-500 text-sm">‡∏•‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ù‡∏±‡πà‡∏á‡∏ã‡πâ‡∏≤‡∏¢‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡∏ó‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ô 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</p>
                            </div>
                        </div>
                        <div class="mt-8">
                            <button id="how-to-play-btn"
                                class="px-4 py-2 rounded-lg border border-gray-300 text-slate-700 hover:bg-gray-200/60 transition-colors">‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏•‡πà‡∏ô</button>
                        </div>
                    </div>
                </div>

                <!-- Quiz Scene -->
                <div id="quiz-scene" class="hidden">
                    <div
                        class="rounded-2xl border border-gray-200 bg-white/70 backdrop-blur p-6 shadow-lg shadow-gray-200/60">
                        <div class="flex items-start justify-between gap-4">
                            <div>
                                <div id="question-counter" class="text-sm text-slate-500 mb-1">‡∏Ç‡πâ‡∏≠ 1 / 10</div>
                                <h3 id="question-text" class="text-lg sm:text-xl font-semibold mb-4 text-slate-900">...
                                </h3>
                            </div>
                            <div class="text-right">
                                <div class="text-xs text-slate-500">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠</div>
                                <div id="timer-display" class="text-2xl font-extrabold text-slate-800">10s</div>
                            </div>
                        </div>
                        <div class="mb-4">
                            <div class="w-full h-1 bg-gray-200 rounded-full overflow-hidden">
                                <div id="quiz-progress-bar"
                                    class="h-full bg-gradient-to-r from-cyan-400 to-emerald-400 transition-all"
                                    style="width: 100%;"></div>
                            </div>
                        </div>
                        <div id="quiz-options-container" class="grid gap-3">
                            <!-- Options will be generated here -->
                        </div>
                        <div class="mt-6 flex flex-wrap items-center justify-end gap-3">
                            <button id="quiz-skip-btn"
                                class="px-4 py-2 rounded-lg border border-gray-300 text-slate-700 hover:bg-gray-200/60 transition-colors">‡∏Ç‡πâ‡∏≤‡∏°‡∏Ç‡πâ‡∏≠
                                (‡∏ô‡∏±‡∏ö‡∏ú‡∏¥‡∏î)</button>
                        </div>
                    </div>
                </div>

                <!-- Match Scene -->
                <div id="match-scene" class="hidden">
                    <div
                        class="rounded-2xl border border-gray-200 bg-white/70 backdrop-blur p-6 shadow-lg shadow-gray-200/60">
                        <div class="mb-4 flex items-start justify-between">
                            <div>
                                <div id="match-page-counter" class="text-sm text-slate-500 mb-1">‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà ‚Äî ‡∏´‡∏ô‡πâ‡∏≤ 1 / 2
                                </div>
                                <h3 class="text-lg sm:text-xl font-semibold text-slate-900">
                                    ‡∏•‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ã‡πâ‡∏≤‡∏¢‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡∏ó‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡πÄ‡∏´‡∏•‡∏∑‡∏≠ <span id="remaining-pairs">5</span> ‡∏Ñ‡∏π‡πà)
                                </h3>
                            </div>
                            <div class="text-right">
                                <div class="text-xs text-slate-500">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠</div>
                                <div id="match-timer-display" class="text-2xl font-extrabold text-slate-800">10s</div>
                            </div>
                        </div>
                        <div class="grid sm:grid-cols-2 gap-4">
                            <!-- Left column -->
                            <div id="match-left-column" class="grid gap-2">
                                <!-- Draggable items will be generated here -->
                            </div>
                            <!-- Right column -->
                            <div id="match-right-column" class="grid gap-2">
                                <!-- Droppable targets will be generated here -->
                            </div>
                        </div>
                        <div class="mt-6 flex flex-wrap items-center justify-end gap-3">
                            <button id="match-skip-btn"
                                class="px-4 py-2 rounded-lg border border-gray-300 text-slate-700 hover:bg-gray-200/60 transition-colors">‡∏Ç‡πâ‡∏≤‡∏°‡∏Ñ‡∏π‡πà‡∏ô‡∏µ‡πâ
                                (‡∏ô‡∏±‡∏ö‡∏ú‡∏¥‡∏î)</button>
                        </div>
                    </div>
                </div>

                <!-- Summary Scene -->
                <div id="summary-scene" class="hidden">
                    <div
                        class="rounded-2xl border border-gray-200 bg-white/70 backdrop-blur p-6 shadow-lg shadow-gray-200/60 text-center py-10">
                        <div class="mb-4 text-sm text-slate-500">‡∏à‡∏ö‡πÄ‡∏Å‡∏°‡πÅ‡∏•‡πâ‡∏ß!</div>
                        <div id="final-score"
                            class="text-5xl font-black bg-gradient-to-r from-cyan-500 to-emerald-500 bg-clip-text text-transparent">
                            0 / 100
                        </div>
                        <div class="mt-2 text-slate-600">‡πÅ‡∏£‡∏á‡∏Ñ‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì: <span id="final-rank"
                                class="text-2xl font-extrabold text-emerald-500">C</span></div>
                        <div class="mt-8 flex items-center justify-center gap-3">
                            <button id="home-btn"
                                class="px-4 py-2 rounded-lg border border-gray-300 text-slate-700 hover:bg-gray-200/60 transition-colors">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
                            <button id="restart-btn"
                                class="px-5 py-3 rounded-xl font-semibold bg-gradient-to-r from-cyan-500 to-emerald-500 text-slate-900 hover:from-cyan-400 hover:to-emerald-400 transition-all shadow-lg shadow-emerald-500/30">‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
                        </div>
                    </div>
                </div>
            </main>

            <!-- Footer -->
            <footer class="mt-8 text-center text-xs text-slate-500">
                ¬© <span id="year"></span> Science Games ‚Äî UX/UI by Tailwind
            </footer>
        </div>
    </div>

    <!-- Instruction Modal -->
    <div id="instruction-modal"
        class="modal-overlay fixed inset-0 bg-black/50 flex items-center justify-center p-4 opacity-0 pointer-events-none z-50">
        <div class="modal-content transform scale-95 max-w-md w-full">
            <div class="rounded-2xl border border-gray-200 bg-white backdrop-blur p-6 shadow-xl">
                <h3 class="text-xl font-bold mb-4 text-emerald-500">‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏•‡πà‡∏ô</h3>

                <div class="space-y-4 text-slate-600 mb-6">
                    <div>
                        <strong class="text-cyan-500">üöÄ ‡πÄ‡∏Å‡∏°‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° (Quiz Game)</strong>
                        <ul class="list-disc list-inside mt-1 pl-2 text-sm space-y-1">
                            <li>‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏à‡∏≤‡∏Å 4 ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</li>
                            <li>‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö 10 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</li>
                            <li>‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏µ‡πÄ‡∏ß‡∏•‡∏≤ 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</li>
                        </ul>
                    </div>
                    <div>
                        <strong class="text-fuchsia-500">üß© ‡πÄ‡∏Å‡∏°‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà (Match Game)</strong>
                        <ul class="list-disc list-inside mt-1 pl-2 text-sm space-y-1">
                            <li>‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Ñ‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ù‡∏±‡πà‡∏á‡∏ã‡πâ‡∏≤‡∏¢ ‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≤‡∏Å‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡∏ö‡∏ô‡∏Ñ‡∏π‡πà‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ù‡∏±‡πà‡∏á‡∏Ç‡∏ß‡∏≤</li>
                            <li>‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏ñ‡∏π‡∏Å‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö 10 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</li>
                            <li>‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏£‡∏≠‡∏ö (5 ‡∏Ñ‡∏π‡πà) ‡∏°‡∏µ‡πÄ‡∏ß‡∏•‡∏≤ 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡∏ï‡πà‡∏≠ 1 ‡∏Ñ‡∏π‡πà‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏à‡∏±‡∏ö</li>
                        </ul>
                    </div>
                    <div>
                        <strong class="text-slate-700">‡∏Å‡∏é‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</strong>
                        <ul class="list-disc list-inside mt-1 pl-2 text-sm space-y-1">
                            <li>‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≤‡∏°‡∏Ç‡πâ‡∏≠, ‡∏õ‡∏•‡πà‡∏≠‡∏¢‡πÉ‡∏´‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏´‡∏°‡∏î, ‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏ú‡∏¥‡∏î ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ô‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏ú‡∏¥‡∏î (‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)</li>
                            <li>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 100 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</li>
                        </ul>
                    </div>
                </div>

                <button id="close-modal-btn"
                    class="w-full px-5 py-3 rounded-xl font-semibold bg-gradient-to-r from-cyan-500 to-emerald-500 text-slate-900 hover:from-cyan-400 hover:to-emerald-400 transition-all">‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß</button>
            </div>
        </div>
    </div>

    <!-- Explanation Modal -->
    <div id="explanation-modal"
        class="modal-overlay fixed inset-0 bg-black/50 flex items-center justify-center p-4 opacity-0 pointer-events-none z-50">
        <div class="modal-content transform scale-95 max-w-md w-full">
            <div class="rounded-2xl border border-gray-200 bg-white backdrop-blur p-6 shadow-xl">
                <h3 id="explanation-title" class="text-xl font-bold mb-3 text-emerald-500"></h3>
                <p id="explanation-text" class="text-slate-600 mb-4"></p>
                <button id="next-question-btn"
                    class="w-full px-5 py-3 rounded-xl font-semibold bg-gradient-to-r from-cyan-500 to-emerald-500 text-slate-900 hover:from-cyan-400 hover:to-emerald-400 transition-all">‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡πÑ‡∏õ</button>
            </div>
        </div>
    </div>


    <script>
        // ---------- Game Data ----------
        const QUIZ_QUESTIONS = [
            { q: "‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Ç‡∏≠‡∏á‡πÅ‡∏£‡∏á‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?", options: ["‡∏ô‡∏¥‡∏ß‡∏ï‡∏±‡∏ô", "‡∏à‡∏π‡∏•", "‡∏ß‡∏±‡∏ï‡∏ï‡πå", "‡πÇ‡∏ß‡∏•‡∏ï‡πå"], answer: 0, explanation: "‡∏ô‡∏¥‡∏ß‡∏ï‡∏±‡∏ô (Newton) ‡∏Ñ‡∏∑‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Ç‡∏≠‡∏á‡πÅ‡∏£‡∏á‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö SI ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏≤‡∏°‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏≠‡πÅ‡∏ã‡∏Å ‡∏ô‡∏¥‡∏ß‡∏ï‡∏±‡∏ô" },
            { q: "‡∏ô‡πâ‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏ó‡∏∞‡πÄ‡∏•‡∏ó‡∏µ‡πà‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£?", options: ["50¬∞C", "80¬∞C", "100¬∞C", "120¬∞C"], answer: 2, explanation: "‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏Å‡∏≤‡∏®‡∏õ‡∏Å‡∏ï‡∏¥ (‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏ó‡∏∞‡πÄ‡∏•) ‡∏ô‡πâ‡∏≥‡∏à‡∏∞‡πÄ‡∏î‡∏∑‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ 100¬∞C ‡∏´‡∏£‡∏∑‡∏≠ 212¬∞F" },
            { q: "‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πá‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏ò‡∏≤‡∏ï‡∏∏‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?", options: ["‡πÇ‡∏°‡πÄ‡∏•‡∏Å‡∏∏‡∏•", "‡∏™‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö", "‡∏≠‡∏∞‡∏ï‡∏≠‡∏°", "‡πÑ‡∏≠‡∏≠‡∏≠‡∏ô"], answer: 2, explanation: "‡∏≠‡∏∞‡∏ï‡∏≠‡∏° (Atom) ‡∏Ñ‡∏∑‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πá‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏™‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏ö‡πà‡∏á‡πÅ‡∏¢‡∏Å‡πÑ‡∏î‡πâ‡∏≠‡∏µ‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ó‡∏≤‡∏á‡πÄ‡∏Ñ‡∏°‡∏µ" },
            { q: "‡∏Ç‡πâ‡∏≠‡πÉ‡∏î‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏´‡∏•‡πà‡∏á‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô?", options: ["‡∏ñ‡πà‡∏≤‡∏ô‡∏´‡∏¥‡∏ô", "‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏î‡∏¥‡∏ö", "‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡πÅ‡∏™‡∏á‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå", "‡∏Å‡πä‡∏≤‡∏ã‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥"], answer: 2, explanation: "‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡πÅ‡∏™‡∏á‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡πÑ‡∏õ ‡∏ï‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÄ‡∏û‡∏•‡∏¥‡∏á‡∏ü‡∏≠‡∏™‡∏ã‡∏¥‡∏•‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏à‡∏≥‡∏Å‡∏±‡∏î" },
            { q: "‡πÄ‡∏•‡∏ô‡∏™‡πå‡∏ô‡∏π‡∏ô‡∏°‡∏µ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏î‡πà‡∏ô‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?", options: ["‡∏£‡∏ß‡∏°‡πÅ‡∏™‡∏á", "‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡πÅ‡∏™‡∏á", "‡∏î‡∏π‡∏î‡∏ã‡∏±‡∏ö‡πÅ‡∏™‡∏á", "‡∏™‡∏∞‡∏ó‡πâ‡∏≠‡∏ô‡πÅ‡∏™‡∏á"], answer: 0, explanation: "‡πÄ‡∏•‡∏ô‡∏™‡πå‡∏ô‡∏π‡∏ô (Convex Lens) ‡∏°‡∏µ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏ß‡∏°‡πÅ‡∏™‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏à‡∏∏‡∏î‡πÇ‡∏ü‡∏Å‡∏±‡∏™‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏†‡∏≤‡∏û‡∏à‡∏£‡∏¥‡∏á‡∏´‡∏±‡∏ß‡∏Å‡∏•‡∏±‡∏ö" },
            { q: "‡∏™‡∏≤‡∏£‡∏•‡∏∞‡∏•‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡πà‡∏≤ pH = 3 ‡∏à‡∏±‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏∞‡πÑ‡∏£?", options: ["‡∏Å‡∏£‡∏î", "‡∏Å‡∏•‡∏≤‡∏á", "‡πÄ‡∏ö‡∏™", "‡πÄ‡∏Å‡∏•‡∏∑‡∏≠"], answer: 0, explanation: "‡∏Ñ‡πà‡∏≤ pH ‡∏ó‡∏µ‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 7 ‡πÅ‡∏™‡∏î‡∏á‡∏ñ‡∏∂‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏£‡∏î ‡∏¢‡∏¥‡πà‡∏á‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≠‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏£‡∏î‡∏Å‡πá‡∏¢‡∏¥‡πà‡∏á‡∏™‡∏π‡∏á" },
            { q: "‡∏Å‡∏é‡∏Ç‡∏≠‡∏á‡πÇ‡∏≠‡∏´‡πå‡∏°‡∏Å‡∏•‡πà‡∏≤‡∏ß‡∏ß‡πà‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£?", options: ["P = IV", "V = IR", "F = ma", "Q = mcŒîT"], answer: 1, explanation: "‡∏Å‡∏é‡∏Ç‡∏≠‡∏á‡πÇ‡∏≠‡∏´‡πå‡∏° (Ohm's Law) ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πà‡∏≤‡∏á‡∏®‡∏±‡∏Å‡∏¢‡πå (V), ‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÑ‡∏ü‡∏ü‡πâ‡∏≤ (I), ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≤‡∏ô‡∏ó‡∏≤‡∏ô (R) ‡πÉ‡∏ô‡∏ß‡∏á‡∏à‡∏£‡πÑ‡∏ü‡∏ü‡πâ‡∏≤" },
            { q: "‡∏Å‡∏≤‡∏£‡πÄ‡∏ú‡∏≤‡∏ú‡∏•‡∏≤‡∏ç‡∏Å‡∏•‡∏π‡πÇ‡∏Ñ‡∏™‡πÉ‡∏ô‡πÄ‡∏ã‡∏•‡∏•‡πå‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å?", options: ["‡πÑ‡∏ô‡πÇ‡∏ï‡∏£‡πÄ‡∏à‡∏ô", "‡∏Ñ‡∏≤‡∏£‡πå‡∏ö‡∏≠‡∏ô‡πÑ‡∏î‡∏≠‡∏≠‡∏Å‡πÑ‡∏ã‡∏î‡πå", "‡∏≠‡∏≠‡∏Å‡∏ã‡∏¥‡πÄ‡∏à‡∏ô", "‡∏Æ‡∏µ‡πÄ‡∏•‡∏µ‡∏¢‡∏°"], answer: 2, explanation: "‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏ã‡∏•‡∏•‡πå (Cellular Respiration) ‡πÉ‡∏ä‡πâ‡πÅ‡∏Å‡πä‡∏™‡∏≠‡∏≠‡∏Å‡∏ã‡∏¥‡πÄ‡∏à‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏•‡∏≤‡∏¢‡∏Å‡∏•‡∏π‡πÇ‡∏Ñ‡∏™‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô (ATP)" },
            { q: "‡∏Å‡∏≤‡∏£‡∏û‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô (convection) ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?", options: ["‡∏Å‡∏≤‡∏£‡∏ñ‡πà‡∏≤‡∏¢‡πÄ‡∏ó‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏ú‡πà‡∏£‡∏±‡∏á‡∏™‡∏µ", "‡∏Å‡∏≤‡∏£‡∏ñ‡πà‡∏≤‡∏¢‡πÄ‡∏ó‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏ô‡∏Ç‡∏≠‡∏á‡∏≠‡∏ô‡∏∏‡∏†‡∏≤‡∏Ñ", "‡∏Å‡∏≤‡∏£‡∏ñ‡πà‡∏≤‡∏¢‡πÄ‡∏ó‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡πÑ‡∏´‡∏•", "‡∏Å‡∏≤‡∏£‡∏ñ‡πà‡∏≤‡∏¢‡πÄ‡∏ó‡∏ú‡πà‡∏≤‡∏ô‡∏™‡∏∏‡∏ç‡∏¢‡∏≤‡∏Å‡∏≤‡∏®‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô"], answer: 2, explanation: "‡∏Å‡∏≤‡∏£‡∏û‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ñ‡πà‡∏≤‡∏¢‡πÄ‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡πÇ‡∏°‡πÄ‡∏•‡∏Å‡∏∏‡∏•‡πÉ‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏´‡∏•‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏Å‡πä‡∏™ ‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡∏¥‡∏î‡∏•‡∏°‡∏ö‡∏Å‡∏•‡∏°‡∏ó‡∏∞‡πÄ‡∏•" },
            { q: "‡∏ß‡∏á‡∏à‡∏£‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏ï‡πà‡∏≠‡πÅ‡∏ö‡∏ö‡∏≠‡∏ô‡∏∏‡∏Å‡∏£‡∏°‡∏°‡∏µ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏î‡πà‡∏ô‡∏Ç‡πâ‡∏≠‡πÉ‡∏î?", options: ["‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô‡∏ó‡∏∏‡∏Å‡∏à‡∏∏‡∏î", "‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô‡∏ó‡∏∏‡∏Å‡∏à‡∏∏‡∏î", "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≤‡∏ô‡∏ó‡∏≤‡∏ô‡∏£‡∏ß‡∏°‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß", "‡πÑ‡∏ü‡∏î‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏•‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏î"], answer: 1, explanation: "‡πÉ‡∏ô‡∏ß‡∏á‡∏à‡∏£‡∏≠‡∏ô‡∏∏‡∏Å‡∏£‡∏° ‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏à‡∏∞‡πÑ‡∏´‡∏•‡πÑ‡∏õ‡πÉ‡∏ô‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô‡∏ï‡∏•‡∏≠‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏ß‡∏á‡∏à‡∏£" },
        ];

        const MATCH_PAGES = [
            [{ left: "H2O", right: "‡∏ô‡πâ‡∏≥" }, { left: "NaCl", right: "‡πÄ‡∏Å‡∏•‡∏∑‡∏≠‡πÅ‡∏Å‡∏á" }, { left: "O2", right: "‡∏≠‡∏≠‡∏Å‡∏ã‡∏¥‡πÄ‡∏à‡∏ô" }, { left: "CO2", right: "‡∏Ñ‡∏≤‡∏£‡πå‡∏ö‡∏≠‡∏ô‡πÑ‡∏î‡∏≠‡∏≠‡∏Å‡πÑ‡∏ã‡∏î‡πå" }, { left: "Fe", right: "‡πÄ‡∏´‡∏•‡πá‡∏Å" }],
            [{ left: "Photosynthesis", right: "‡∏™‡∏±‡∏á‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏î‡πâ‡∏ß‡∏¢‡πÅ‡∏™‡∏á" }, { left: "Mitosis", right: "‡πÑ‡∏°‡πÇ‡∏ó‡∏ã‡∏¥‡∏™" }, { left: "Condensation", right: "‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡πÅ‡∏ô‡πà‡∏ô" }, { left: "Voltage", right: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πà‡∏≤‡∏á‡∏®‡∏±‡∏Å‡∏¢‡πå" }, { left: "Ohm", right: "‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≤‡∏ô‡∏ó‡∏≤‡∏ô" }],
        ];

        // ---------- DOM Elements ----------
        // Scenes
        const introScene = document.getElementById('intro-scene');
        const quizScene = document.getElementById('quiz-scene');
        const matchScene = document.getElementById('match-scene');
        const summaryScene = document.getElementById('summary-scene');

        // Header & Progress
        const scoreDisplay = document.getElementById('score-display');

        // Quiz Elements
        const questionCounter = document.getElementById('question-counter');
        const questionText = document.getElementById('question-text');
        const timerDisplay = document.getElementById('timer-display');
        const quizProgressBar = document.getElementById('quiz-progress-bar');
        const quizOptionsContainer = document.getElementById('quiz-options-container');
        const quizSkipBtn = document.getElementById('quiz-skip-btn');

        // Match Elements
        const matchPageCounter = document.getElementById('match-page-counter');
        const remainingPairsEl = document.getElementById('remaining-pairs');
        const matchTimerDisplay = document.getElementById('match-timer-display');
        const matchLeftColumn = document.getElementById('match-left-column');
        const matchRightColumn = document.getElementById('match-right-column');
        const matchSkipBtn = document.getElementById('match-skip-btn');

        // Summary Elements
        const finalScore = document.getElementById('final-score');
        const finalRank = document.getElementById('final-rank');
        const homeBtn = document.getElementById('home-btn');
        const restartBtn = document.getElementById('restart-btn');

        // Modal
        const instructionModal = document.getElementById('instruction-modal');
        const howToPlayBtn = document.getElementById('how-to-play-btn');
        const closeModalBtn = document.getElementById('close-modal-btn');

        // Explanation Modal Elements
        const explanationModal = document.getElementById('explanation-modal');
        const explanationTitle = document.getElementById('explanation-title');
        const explanationText = document.getElementById('explanation-text');
        const nextQuestionBtn = document.getElementById('next-question-btn');


        // ---------- Game State ----------
        let scene = 'intro';
        let score = 0;
        let qIndex = 0;
        let timeLeft = 10;
        let timerRef = null;
        let currentGame = null;

        // Match specific state
        let matchPageIndex = 0;
        let matchPairs = [];
        let rightOrder = [];
        let matchedKeys = new Set();
        let remainingPairs = 5;
        let draggedKey = null;

        // ---------- Utility Functions ----------
        const clamp = (n, lo, hi) => Math.max(lo, Math.min(hi, n));
        const shuffle = (arr) => {
            const a = [...arr];
            for (let i = a.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [a[i], a[j]] = [a[j], a[i]];
            }
            return a;
        };
        const getRank = (score) => {
            if (score >= 90) return "S";
            if (score >= 75) return "A";
            if (score >= 60) return "B";
            return "C";
        };

        // ---------- Audio Engine ----------
        let audioCtx;
        function initAudio() {
            if (!audioCtx) {
                try {
                    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) {
                    console.error("Web Audio API is not supported in this browser");
                }
            }
        }

        function playSound(type) {
            if (!audioCtx) return;
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            gainNode.gain.setValueAtTime(0, audioCtx.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.3, audioCtx.currentTime + 0.01);

            switch (type) {
                case 'correct':
                    oscillator.type = 'sine';
                    oscillator.frequency.setValueAtTime(600, audioCtx.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(800, audioCtx.currentTime + 0.1);
                    break;
                case 'incorrect':
                    oscillator.type = 'square';
                    oscillator.frequency.setValueAtTime(200, audioCtx.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.1);
                    break;
                case 'click':
                default:
                    oscillator.type = 'triangle';
                    oscillator.frequency.setValueAtTime(440, audioCtx.currentTime);
                    break;
            }

            oscillator.start(audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + 0.2);
            oscillator.stop(audioCtx.currentTime + 0.2);
        }

        // ---------- Scene Management ----------
        function switchScene(newScene) {
            scene = newScene;
            introScene.classList.toggle('hidden', scene !== 'intro');
            quizScene.classList.toggle('hidden', scene !== 'quiz');
            matchScene.classList.toggle('hidden', scene !== 'match');
            summaryScene.classList.toggle('hidden', scene !== 'summary');

            stopTimer();

            if (scene === 'quiz') setupQuiz();
            if (scene === 'match') setupMatch();
            if (scene === 'summary') render();
        }

        // ---------- Game Flow ----------
        function startQuizGame() {
            currentGame = 'quiz';
            score = 0;
            qIndex = 0;
            switchScene('quiz');
        }

        function startMatchGame() {
            currentGame = 'match';
            score = 0;
            matchPageIndex = 0;
            switchScene('match');
        }

        // --- Timer ---
        function startTimer() {
            stopTimer();
            timeLeft = 10;
            timerRef = setInterval(() => {
                timeLeft--;
                render();
                if (timeLeft <= 0) {
                    if (scene === 'quiz') selectAnswer(null); // Timeout is wrong answer
                    if (scene === 'match') handleMatchTimeout();
                }
            }, 1000);
        }

        function stopTimer() {
            if (timerRef) clearInterval(timerRef);
            timerRef = null;
        }

        // --- Quiz Logic ---
        function setupQuiz() {
            renderQuizContent();
            startTimer();
        }

        function selectAnswer(i) {
            stopTimer();
            playSound('click');
            const question = QUIZ_QUESTIONS[qIndex];
            const isCorrect = i === question.answer;

            // Give visual feedback
            const optionButtons = quizOptionsContainer.querySelectorAll('button');
            optionButtons.forEach((btn, index) => {
                btn.disabled = true;
                if (index === question.answer) {
                    btn.classList.add('bg-emerald-500/50', 'border-emerald-500');
                }
                if (index === i && !isCorrect) {
                    btn.classList.add('bg-rose-500/50', 'border-rose-500');
                }
            });

            if (isCorrect) {
                playSound('correct');
                score += 10;
                showExplanation("‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å!", question.explanation);
            } else {
                playSound('incorrect');
                showExplanation("‡∏ô‡πà‡∏≤‡πÄ‡∏™‡∏µ‡∏¢‡∏î‡∏≤‡∏¢ ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏∑‡∏≠...", question.explanation);
            }
        }

        function goNextQuiz() {
            hideExplanation();
            if (qIndex + 1 >= QUIZ_QUESTIONS.length) {
                switchScene('summary');
            } else {
                qIndex++;
                setupQuiz();
            }
        }

        // --- Match Logic ---
        function setupMatch() {
            const page = MATCH_PAGES[matchPageIndex];
            matchPairs = page.map((p, idx) => ({ ...p, key: `${matchPageIndex}-${idx}` }));
            rightOrder = shuffle([...matchPairs.map(p => p.key)]);
            matchedKeys = new Set();
            draggedKey = null;
            remainingPairs = 5;
            renderMatchContent();
            startTimer();
        }

        function handleMatchTimeout() {
            playSound('incorrect');
            const available = matchPairs.map(p => p.key).filter(k => !matchedKeys.has(k));
            if (available.length === 0) return;
            const removeOne = available[Math.floor(Math.random() * available.length)];

            matchedKeys.add(removeOne);
            remainingPairs--;

            if (matchedKeys.size >= 5) {
                stopTimer();
                if (scene === 'match' && matchPageIndex === 0) {
                    matchPageIndex = 1;
                    setupMatch();
                } else {
                    switchScene('summary');
                }
            } else {
                startTimer();
            }
            render();
        }

        // --- Drag and Drop Handlers ---
        function handleDragStart(e) {
            draggedKey = e.target.dataset.key;
            e.dataTransfer.effectAllowed = 'move';
            e.target.classList.add('dragging');
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
            const target = e.currentTarget;
            if (target.dataset.key !== draggedKey) {
                target.classList.add('drag-over');
            }
        }

        function handleDragLeave(e) {
            e.currentTarget.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            const dropTarget = e.currentTarget;
            dropTarget.classList.remove('drag-over');
            const droppedOnKey = dropTarget.dataset.key;

            if (!draggedKey || matchedKeys.has(droppedOnKey)) return;

            if (draggedKey === droppedOnKey) {
                score += 10;
                handleCorrectMatch(droppedOnKey);
            } else {
                playSound('incorrect');
                dropTarget.classList.add('shake', 'bg-rose-500/50');
                setTimeout(() => dropTarget.classList.remove('shake', 'bg-rose-500/50'), 500);
            }
            draggedKey = null;
        }

        function handleCorrectMatch(key) {
            playSound('correct');
            matchedKeys.add(key);
            remainingPairs--;

            const leftItem = matchLeftColumn.querySelector(`[data-key="${key}"]`);
            const rightItem = matchRightColumn.querySelector(`[data-key="${key}"]`);

            if (leftItem) leftItem.classList.add('fade-out');
            if (rightItem) rightItem.classList.add('fade-out');

            setTimeout(() => {
                if (leftItem) leftItem.classList.add('matched');
                if (rightItem) rightItem.classList.add('matched');
            }, 500);

            if (matchedKeys.size >= 5) {
                stopTimer();
                setTimeout(() => {
                    if (scene === 'match' && matchPageIndex === 0) {
                        matchPageIndex = 1;
                        setupMatch();
                    } else {
                        switchScene('summary');
                    }
                }, 500); // Wait for fade out
            } else {
                startTimer();
            }
            render();
        }

        // ---------- Rendering ----------
        function render() {
            scoreDisplay.textContent = `‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${score}`;
            updateTimerDisplay();

            if (scene === 'match') {
                remainingPairsEl.textContent = remainingPairs;
                matchPageCounter.textContent = `‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà ‚Äî ‡∏´‡∏ô‡πâ‡∏≤ ${matchPageIndex + 1} / 2`;
            }
            if (scene === 'summary') renderSummaryContent();
        }

        function updateTimerDisplay() {
            const timerEl = scene === 'quiz' ? timerDisplay : matchTimerDisplay;
            if (timerEl) {
                timerEl.textContent = `${timeLeft}s`;
                timerEl.style.color = timeLeft <= 3 ? '#f43f5e' : '#1e293b'; // Rose-500 or Slate-800
            }
            if (scene === 'quiz') {
                const quizProgressPercent = clamp((timeLeft / 10) * 100, 0, 100);
                quizProgressBar.style.width = `${quizProgressPercent}%`;
            }
        }

        function renderQuizContent() {
            const question = QUIZ_QUESTIONS[qIndex];
            questionCounter.textContent = `‡∏Ç‡πâ‡∏≠ ${qIndex + 1} / ${QUIZ_QUESTIONS.length}`;
            questionText.textContent = question.q;
            quizOptionsContainer.innerHTML = '';

            question.options.forEach((option, i) => {
                const button = document.createElement('button');
                button.className = "w-full text-left p-4 rounded-lg border border-gray-300 bg-white/80 hover:bg-gray-200/80 transition-all disabled:opacity-70 disabled:cursor-not-allowed disabled:hover:bg-white/80";
                button.textContent = option;
                button.onclick = () => selectAnswer(i);
                quizOptionsContainer.appendChild(button);
            });
        }

        function renderMatchContent() {
            matchLeftColumn.innerHTML = '';
            matchRightColumn.innerHTML = '';

            // Create left items (draggable)
            matchPairs.forEach(pair => {
                const div = document.createElement('div');
                div.textContent = pair.left;
                div.dataset.key = pair.key;
                div.draggable = true;
                div.className = "draggable-item p-3 rounded-lg border border-gray-300 bg-white transition-all shadow-sm";
                if (matchedKeys.has(pair.key)) {
                    div.classList.add('matched');
                }
                div.addEventListener('dragstart', handleDragStart);
                div.addEventListener('dragend', handleDragEnd);
                matchLeftColumn.appendChild(div);
            });

            // Create right items (droppable) based on shuffled order
            rightOrder.forEach(key => {
                const pair = matchPairs.find(p => p.key === key);
                const div = document.createElement('div');
                div.textContent = pair.right;
                div.dataset.key = pair.key;
                div.className = "drop-target p-3 rounded-lg border-2 border-dashed border-gray-400 transition-colors";
                if (matchedKeys.has(pair.key)) {
                    div.classList.add('matched', 'border-solid', 'border-emerald-500/50', 'bg-emerald-100/80');
                }
                div.addEventListener('dragover', handleDragOver);
                div.addEventListener('dragleave', handleDragLeave);
                div.addEventListener('drop', handleDrop);
                matchRightColumn.appendChild(div);
            });
        }

        function renderSummaryContent() {
            finalScore.textContent = `${score} / 100`;
            finalRank.textContent = getRank(score);
        }

        // --- Modals ---
        function showInstructionModal() {
            instructionModal.classList.remove('opacity-0', 'pointer-events-none');
            instructionModal.querySelector('.modal-content').classList.remove('scale-95');
        }

        function hideInstructionModal() {
            instructionModal.classList.add('opacity-0', 'pointer-events-none');
            instructionModal.querySelector('.modal-content').classList.add('scale-95');
        }

        function showExplanation(title, text) {
            explanationTitle.textContent = title;
            explanationText.textContent = text;
            explanationModal.classList.remove('opacity-0', 'pointer-events-none');
            explanationModal.querySelector('.modal-content').classList.remove('scale-95');
        }

        function hideExplanation() {
            explanationModal.classList.add('opacity-0', 'pointer-events-none');
            explanationModal.querySelector('.modal-content').classList.add('scale-95');
        }

        // ---------- Event Listeners ----------
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('year').textContent = new Date().getFullYear();

            const startQuizBtn = document.getElementById('start-quiz-btn');
            const startMatchBtn = document.getElementById('start-match-btn');

            startQuizBtn.addEventListener('click', () => {
                playSound('click');
                initAudio();
                startQuizGame();
            });

            startMatchBtn.addEventListener('click', () => {
                playSound('click');
                initAudio();
                startMatchGame();
            });

            howToPlayBtn.addEventListener('click', () => {
                playSound('click');
                showInstructionModal();
            });

            closeModalBtn.addEventListener('click', () => {
                playSound('click');
                hideInstructionModal();
            });

            // Skip buttons
            quizSkipBtn.addEventListener('click', () => selectAnswer(null));
            matchSkipBtn.addEventListener('click', handleMatchTimeout);

            // Summary buttons
            homeBtn.addEventListener('click', () => {
                playSound('click');
                switchScene('intro');
            });
            restartBtn.addEventListener('click', () => {
                playSound('click');
                if (currentGame === 'quiz') {
                    startQuizGame();
                } else if (currentGame === 'match') {
                    startMatchGame();
                }
            });

            // Explanation modal button
            nextQuestionBtn.addEventListener('click', goNextQuiz);

            // Close modals with Escape key
            window.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    hideInstructionModal();
                }
            });
        });
    </script>
</body>

</html>
